ğŸ” DEBUG - CONEXÃƒO DE CARTEIRA E DADOS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… CORREÃ‡Ã•ES APLICADAS:

1. âœ… Corrigido updateUI() â†’ updateWalletUI()
2. âœ… Adicionado logs detalhados em todas as funÃ§Ãµes
3. âœ… Corrigido updateWalletUI() (nÃ£o usa mais connectBtn)
4. âœ… Message listener agora usa address diretamente
5. âœ… Adicionado setTimeout(1s) para check de conexÃ£o
6. âœ… Adicionado loadTokenList() apÃ³s conectar

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ§ª TESTE PASSO A PASSO:

1. ABRIR CONSOLE (F12)
   âœ… Ver todos os logs

2. ABRIR PÃGINA:
   http://localhost:3000/runes-swap.html

3. LOGS ESPERADOS (inicial):
   ```
   ğŸš€ Runes Swap DeFi loaded
   ğŸ”„ DeFi Swap initializing...
   â° Checking parent connection after 1s...
   â³ Waiting for window.krayWallet...
   ```

4. CLICAR "Connect Wallet" (navbar)
   âœ… Modal abre

5. CLICAR "KrayWallet"
   âœ… Extension popup abre

6. DESBLOQUEAR E APROVAR
   âœ… Extension autoriza conexÃ£o

7. LOGS ESPERADOS (apÃ³s conectar):
   ```
   PARENT (runes-swap.html):
   ğŸ”º Connecting KrayWallet...
   âœ… Wallet connected: bc1p...
   ğŸ’¾ Wallet type: kraywallet
   ğŸ”„ Updated wallet UI
   ğŸ“¡ Notified iframe about wallet connection
   
   IFRAME (defi-swap.html):
   ğŸ“¨ Received message from parent: {type: 'CONNECT_WALLET', address: 'bc1p...'}
   ğŸ“¡ Received connect wallet message from parent
      Address: bc1p...
   âœ… Synced with parent wallet: bc1p...
   ğŸ”„ updateWalletUI called
      isConnected: true
      userAddress: bc1p...
   âœ… Wallet UI updated
   ğŸª™ Loading runes from wallet...
   ğŸ“¦ Runes result: {success: true, runes: Array(1)}
   âœ… Runes loaded: 1 runes
   âœ… Balance loaded: 2053
   ğŸ“‹ Loading token list...
   ```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” DIAGNÃ“STICO DE PROBLEMAS:

PROBLEMA 1: "Please connect your wallet first"
CAUSA: userAddress ou isConnected estÃ¡ false
DEBUG:
  1. Abrir console
  2. Digitar: window.frames[0].userAddress
  3. Digitar: window.frames[0].isConnected
  4. Se undefined ou false â†’ nÃ£o sincronizou

PROBLEMA 2: NÃ£o aparece balance/runes
CAUSA: window.krayWallet nÃ£o tem mÃ©todos
DEBUG:
  1. No console do iframe:
  2. Digitar: window.krayWallet
  3. Digitar: window.krayWallet.getBalance
  4. Digitar: window.krayWallet.getRunes
  5. Se undefined â†’ extension nÃ£o injetou API

PROBLEMA 3: Mensagem nÃ£o chega no iframe
CAUSA: postMessage nÃ£o estÃ¡ sendo enviado
DEBUG:
  1. Buscar no console: "ğŸ“¡ Notified iframe"
  2. Se nÃ£o aparecer â†’ app.js nÃ£o estÃ¡ enviando
  3. Verificar se app.js foi modificado corretamente

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”§ COMANDOS DE DEBUG NO CONSOLE:

// Verificar parent (runes-swap.html)
isWalletConnected
connectedAddress
currentWallet

// Verificar iframe (defi-swap.html)
// Primeiro, entrar no iframe:
cd(frames[0])

// Depois:
userAddress
isConnected
userBalance
userRunes
window.krayWallet

// Testar mÃ©todos da wallet:
await window.krayWallet.getBalance()
await window.krayWallet.getRunes()
await window.krayWallet.getInscriptions()

// ForÃ§ar sincronizaÃ§Ã£o manual:
window.postMessage({
    type: 'CONNECT_WALLET',
    wallet: 'kraywallet',
    address: parent.connectedAddress
}, '*')

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š FLUXO ESPERADO:

1. User conecta no navbar
   â†“
2. app.js: isWalletConnected = true
   â†“
3. app.js: connectedAddress = "bc1p..."
   â†“
4. app.js: postMessage para iframe
   â†“
5. iframe: Recebe mensagem
   â†“
6. iframe: userAddress = event.data.address
   â†“
7. iframe: isConnected = true
   â†“
8. iframe: updateWalletUI()
   â†“
9. iframe: loadUserBalance()
   â†“
10. iframe: loadUserRunes()
   â†“
11. iframe: loadTokenList()
   â†“
12. âœ… Dados aparecem!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸš¨ SE AINDA NÃƒO FUNCIONAR:

1. LIMPAR CACHE:
   Ctrl+Shift+Delete
   âœ… Limpar cache e cookies
   âœ… Recarregar pÃ¡gina

2. VERIFICAR EXTENSION:
   chrome://extensions
   âœ… KrayWallet instalada?
   âœ… KrayWallet ativada?
   âœ… Abrir popup e desbloquear

3. VERIFICAR ARQUIVOS:
   âœ… app.js tem postMessage?
   âœ… defi-swap.html tem message listener?
   âœ… Ambos estÃ£o na versÃ£o corrigida?

4. TESTAR CONEXÃƒO DIRETA:
   Abrir: http://localhost:3000/backups/defi-working-version/defi-swap.html
   âœ… Conectar wallet diretamente
   âœ… Ver se funciona sem iframe

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ PRÃ“XIMOS PASSOS (se funcionar):

âœ… Wallet conecta
âœ… Balance aparece
âœ… Runes aparecem
âœ… Pode selecionar tokens
âœ… Pode fazer swap

Se NÃƒO funcionar:
â†’ Me envie os logs do console
â†’ Me envie resultado dos comandos de debug
â†’ Vou investigar mais a fundo

TESTE AGORA E ME DIGA O QUE APARECE! ğŸ”

